<!DOCTYPE html>
<!-- saved from url=(0032)http://m.120ask.com/askg/asktype -->
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

		<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
		<meta content="yes" name="apple-mobile-web-app-capable">
		<meta content="black" name="apple-mobile-web-app-status-bar-style">
		<meta content="telephone=no" name="format-detection">
		<title>咨询医生</title>
		<meta name="description" content="">
		<meta name="keywords" content="">
		<meta http-equiv="Cache-Control" content="no-transform">
		<meta http-equiv="Cache-Control" content="no-siteapp">
		<link rel="icon" href="http://www.120ask.com/favicon.ico" type="image/x-icon">
		<link href="./doctor/index.css" rel="stylesheet" type="text/css">
		<script src="./doctor/jquery-1.7.1.min.js"></script>
	</head>
	<body>
		<header class="s_header">
			<nav>
				<a href="javascript:void(0);" onclick="history.go(-1)" class="bg"><span>返回</span></a>
				<a href="https://m.120ask.com/">快速问医生</a>
			</nav>
		</header>
		<div id="page">
			<div class="question-page">
				<div class="question-about">
					<div class="write-title"><span>标题：</span><input type="text" onblur="statAskOption(&#39;ask_title&#39;,&#39;title&#39;)"
						 id="ask_title" value="" placeholder="请输入标题">
					</div>
					<!-- <img src="doctor/ask_icon.png" > -->
					<div class="write-title write-cont">
						<span>详情：</span>
						<textarea placeholder="请输入详情" onblur="statAskOption(&#39;ask_content&#39;,&#39;content&#39;)" id="ask_content"></textarea>
					</div>
					<input type="hidden" name="ask_name" id="ask_name" value="">

					<div class="load-img">
						<div class="img-part">
							<form method="post" enctype="multipart/form-data" action="" target="upload" id="publisher_image_form">
								<div id="imgShows">
								</div>
								<span>
									<var>
										<input onclick="if ($(&#39;#imgShows img&#39;).length &gt;= 3) { showError(&#39;最多只能上传3张图片&#39;);  return false; }"
										 name="file1" type="file" onchange="imgUpload(this)">
									</var>
									<i>添加病情照片<br>患处、检查报告或其他资料</i>
								</span>
								<input type="hidden" value="OXZrR0JBNDFhEFk1LDgEdncFITU2KAUAXUA0Lw4EfnBvFx0sJhcZdQ==" name="_csrf">
							</form>
							<iframe name="upload" style="display:none;" src="./zixun_files/saved_resource.html"></iframe>
						</div>
					</div>

					<div class="select-msg clears">
						<div class="select-sex clears">
							<span>性别：</span>
							<var class="clears">
								<i class="on">男</i><i>女</i>
							</var>
						</div>
						<div class="select-birth">
							<span style="width:50px;">年龄：</span>
							<input type="tel" placeholder="请输入" id="user_age">
							<b>
								<i id="age_type">岁</i>
								<select>
									<option>岁</option>
									<option>月</option>
								</select>
								<em></em>
							</b>
						</div>
					</div>

					<input type="hidden" name="phone" id="phone" value="18768871893">
					<input type="hidden" name="code" id="code" value="99">
					<input type="hidden" name="sec" id="sec" value="38d8985ba3ee9e61917172774df583b7">
					<div class="reward-part">
						<span>悬赏：<i>设置悬赏可以吸引更多医生回答问题</i></span>
						<ul class="clears select-reward">
							<li class="no-reward on"><a href="javascript:;">不悬赏</a></li>
							<li class="set-reward"><a href="javascript:;">设置悬赏</a></li>
						</ul>
						<ul class="clears money-list" style="display: none;">
							<li price="2"><a href="javascript:;">2元</a></li>
							<li price="6"><a href="javascript:;">6元</a></li>
							<li price="10"><a href="javascript:;">10元</a></li>
							<li price="16"><a href="javascript:;">16元</a></li>
							<li price="32"><a href="javascript:;">32元</a></li>
							<li price="66"><a href="javascript:;">66元</a></li>
							<li price="88"><a href="javascript:;">88元</a></li>
							<li price="99"><a href="javascript:;">99元</a></li>
						</ul>
					</div>
				</div>
				<input type="hidden" id="osn" value="">
				<div style="height: 55px;"></div>
				<div class="ask-bottom-btn">
					<span><b>剩余名额：193人</b><var>免费向义诊医生咨询</var></span>
					<a href="javascript:void(0);" onclick="dosubmit(1); _czc.push([&#39;_trackEvent&#39;, &#39;ask_new&#39;, &#39;onclick&#39;, &#39;3&#39;]);">提交咨询</a>
				</div>

				<div class="pay-box">
					<div class="bg_zf"></div>
					<div class="box">
						<a class="zhifubao" href="javascript:topay(1);"><i></i><span>支付宝支付</span></a>
						<a class="wechat" href="javascript:topay(2);"><i></i><span>微信支付</span></a>
					</div>
				</div>
			</div>
		</div>
		<div class="confirm_up" style="display:none;">
			<div class="cont">
				<span class="sp">手机号已绑定其他账号，是否使用此手机号绑定的账号进行登录提问？</span>
				<span class="btns"><var id="mobile_login">确定</var><var onclick="this.parentNode.parentNode.parentNode.style.display=&#39;none&#39;;">取消</var></span>
			</div>
		</div>
		<div class="up_notice" style="display: none;">
			<div class="cont">
				<var class="close" onclick="this.parentNode.parentNode.style.display=&#39;none&#39;;">×</var>
				<div class="c">
					<b>免费咨询通知</b>
					<span class="sp1"></span>
					<span class="sp2"><img width="100%" src="./zixun_files/up_exampleimg.jpg"></span>
					<div class="b"><span><em>温馨提示：</em>如需再次提问咨询更多的医生，请点击 → </span><a href="javascript:void(0);" onclick="this.parentNode.parentNode.parentNode.parentNode.style.display=&#39;none&#39;;">悬赏提问</a></div>
				</div>
			</div>
		</div>
		<div class="up_tips">
			<div class="cont">
				<var class="close" onclick="this.parentNode.parentNode.style.display=&#39;none&#39;;">×</var>
				<b class="t">温馨提示</b>
				<span id="up_tips_span"></span>
			</div>
		</div>
		<script type="text/javascript">
			var par_json = {};
			var _czc = _czc || [];
			_czc.push(['_trackEvent', 'ask_new', 'show', 'total']);

			//支付中转页使用
			var storage = window.localStorage;
			if (storage) {
				storage.removeItem("return_pay");
			}
			var num = 1;
			$(function() {
				$(".select-sex var i").click(function() {
					$(this).addClass("on").siblings().removeClass("on")
				});
				$(".select-birth input").change(function() {
					var val = $(this).val();
					$(this).prev("i").html(val);
				});
				$(".select-birth b select").change(function() {
					var val = $(this).val();
					$(this).prev("i").html(val)
				});
				$(".reward-part ul li").each(function() {
					$(this).click(function() {
						var txt = $(this).text();
						$(this).addClass("on").siblings().removeClass("on")
						if ($(this).hasClass("no-reward")) {
							$(".ask-bottom-btn span").html("<b>剩余名额：193人</b><var>免费向义诊医生咨询</var>");
							$(".ask-bottom-btn a").html("提交咨询");
							$(".money-list").css("display", "none");
						} else {
							$(".money-list").css("display", "block");
							$(".money-list li").removeClass("on");
						}
					})
				});
				$(".money-list li").each(function() {
					$(this).click(function() {
						var txt = $(this).text();
						$(this).addClass("on").siblings().removeClass("on");
						$(".ask-bottom-btn span").html("悬赏支付<i>" + txt + "</i>");
						$(".ask-bottom-btn a").html("确定支付");
					})
				});
				$(".pay-box .pay-box-bg").click(function() {
					$(".ListSearchBg").css("display", "none");
					$(".ListSearchBox").css("display", "none");
					$(this).parent().css("display", "none")
				});
			})

			function reloadpic() {
				var check_code = $('.check_code').attr('src', "//www.120ask.com/ask/captcha?v=" + Math.random());
			}

			function statAskOption(i, p) {
				var val = $('#' + i).val();
				if (p != '' && val != '') {
					_czc.push(['_trackEvent', 'ask_new', 'position:' + p, 'onblur']);
				}
			}

			function dosubmit(n) {
				_czc.push(['_trackEvent', 'ask_new', 'dosubmit', 'onclick']);

				var price = $(".money-list .on").attr('price');
				try {
					var content = $.trim($('#ask_content').val());
					var askname = $('#ask_name').val();
					var sex = $.trim($('.select-sex .on').text());
					var age = $.trim($('#user_age').val());
					var ageType = $.trim($('#age_type').html());
					var osn = $.trim($('#osn').val());
					var contLen = content.length;
					var mob = $.trim($("#phone").val());
					var code = $.trim($("#code").val());
					var sec = $.trim($("#sec").val());
					var imgs = $('.upimglistinput');
					var v_checking = $.trim($('#v_checking').val());
					var imgRes = [];
					try {
						imgs.each(function(i) {
							imgRes.push(imgs[i].value);
						});
					} catch (e) {
						//alert(e);
					}
					var token = 'OXZrR0JBNDFhEFk1LDgEdncFITU2KAUAXUA0Lw4EfnBvFx0sJhcZdQ==';

					var title = $.trim($('#ask_title').val());
					var titLen = title.length;
					if (titLen < 10) {
						showError('病情标题不能少于10个字');
						return false;
					}
					if (titLen > 25) {
						showError('病情标题不能多于25个字');
						return false;
					}

					if (contLen < 20) {
						showError('病情描述不能少于20个字');
						return false;
					} else if (sex == '') {
						showError('请选择性别');
						return false;
					} else if (age == '' || age == '请选择' || ageType == '' || (ageType != '岁' && ageType != '月')) {
						showError('请输入年龄');
						$('#issbt').val('0');
						return false;
					} else if (mob == '') {
						showError('请输入手机号');
						return false;
					} else if (code == '') {
						showError('请输入验证码');
						return false;
					} else if (v_checking == '' && 0) {
						showError('请输入验证码');
						return false;
					} else {
						if (price == undefined) {
							price = 0;
						}
						if (n == 1 && price > 0) {
							if ($(".reward-part ul .on").hasClass("no-reward")) {
								return false;
							} else {
								$(".pay-box").css("display", "block");
							}

						}

						par_json = {
							content: content,
							sex: sex,
							age: age,
							age_type: ageType,
							askname: askname,
							imgs: imgRes,
							price: price,
							vCheck: v_checking,
							pt: n,
							osn: osn,
							pro: 'newpost',
							from: '',
							_csrf: token,
							mob: mob,
							code: code,
							sec: sec,
							jeep_mob: 0,
							showtit: 0
						};
						par_json.showtit = 1;
						par_json.title = title;
						if (n == 2 || n == 3 || price <= 0) {
							topay(n);
						}
						return;

					}
				} catch (e) {
					console.log('xxx:' + e);
				}
			}

			function topay(pt) {

				var url = "/askg/asktype/ask";
				par_json.zf = pt;
				if (pt == 3) {
					par_json.bdpay = 'xiongz';
				}
				//par_json.test = 'test';
				var price = par_json.price;
				console.log(par_json);
				$(".ListSearchBg").css("display", "block");
				$(".ListSearchBox").css("display", "block");
				//window.location.replace('http://m.120ask.com/askg/asktype/payinfo?sn=4aneclgaszpknec6&pay_type=wechat');
				//return;
				$.post(url, par_json, function(data) {

					var data = eval('(' + data + ')');
					//console.log(data);
					$(".ListSearchBg").css("display", "none");
					$(".ListSearchBox").css("display", "none");
					if (data.code == 200) {

						if (price == 0) {
							showError(data.msg);
						}
						if (price > 0 && data.data.osn != '') {
							_czc.push(['_trackEvent', 'ask_new', 'succ', 'zf']);
							$('#osn').val(data.data.osn);
							window.location.replace(data.data.nexturl);
						} else {
							_czc.push(['_trackEvent', 'ask_new', 'succ', 'no_zf']);
							window.location.replace(data.data.nexturl);
						}
					} else if (data.code == 401) {
						$(".pay-box").css("display", "none")
						$(".confirm_up").css("display", "block");
						return false;
					} else {
						reloadpic();
						showError(data.msg);
						return false;
					}
				});
			}

			function execUploadImg(img) {
				num++;
				var imgHtml = '<var><input type="hidden" name="img' + num + '" class="upimglistinput" value="' + img +
					'"><img src="//cdn.120askimages.com' + img + '"><i class="delete" onclick="this.parentNode.remove(0)"></i></var>';
				$("#imgShows .loading").remove()
				$("#imgShows").append(imgHtml);
			}

			function imgUpload(upload_field) {
				if (!upload_field.value) {
					//alert(upload_field.value);
					return false;
				}
				var imgHtml =
					'<var class="loading" style="border:1px solid #eee;"><img style="width:50%;margin:11px auto;height:50%;" src="//m.120ask.com/pub/images/loading.gif"></var>';
				$("#imgShows").append(imgHtml);
				$("#publisher_image_form").submit();
			}
			$(".pay-box .bg_zf").click(function() {
				$(this).parent().css("display", "none")
				$(".ListSearchBg").css("display", "none");
				$(".ListSearchBox").css("display", "none");
			})
			//切换手机号登陆
			$("#mobile_login").click(function() {

				par_json.jeep_mob = 1;
				console.log(par_json);
				topay(par_json.zf);
			});
		</script>
		<script>
			function hqyzm() {
				var time = 60;
				var _this = $('#btn');
				if (_this.attr('class') != "hasGet") {
					_this.html(time + "后再获取");
					_this.attr('class', "hasGet");
					var t = setInterval(function() {
						if (time > 1) {
							time--;
							if (time < 10) {
								_this.html("0" + time + "后再获取");
							} else {
								_this.html(time + "后再获取");
							}
							if (true) {};
						} else {
							$('#btn').attr("disabled", false);
							_this.html("获取验证码");
							_this.attr('class', '');
							clearInterval(t);
						}
					}, 1000)
				} else {
					return false;
				}
			}

			function get_ckcode() {
				var mob = $.trim($("#phone").val());
				var reg = /^1[3|4|5|6|7|8|9][0-9]{9}$/;
				if (mob == '') {
					showError('手机号不能为空');
					return false;
				} else if (!reg.test(mob)) {
					showError('手机号有误！');
					return false;
				} else {
					hqyzm();
					$(".ListSearchBg").css("display", "block");
					$(".ListSearchBox").css("display", "block");
					$('#btn').attr("disabled", true);
					var token = 'OXZrR0JBNDFhEFk1LDgEdncFITU2KAUAXUA0Lw4EfnBvFx0sJhcZdQ==';
					var data = {
						'mobile': mob,
						'_csrf': token,
						'signkey': '252d019b3a1d60ea2fc066cbeb1d48d6',
						'rand': 1000
					};

					/*$.getJSON("/askg/asktype/getaskcode", data, function(json){
				$(".ListSearchBg").css("display","none");
	        	$(".ListSearchBox").css("display","none");
				showError(json.data);
				if(json.code == 200)
				{
					$('#sec').val(json.sec);
				}else{
					$('#btn').attr("disabled",false);
				}
			});*/
					$.post("/askg/asktype/getaskcode", data, function(json) {
						$(".ListSearchBg").css("display", "none");
						$(".ListSearchBox").css("display", "none");
						showError(json.data);
						if (json.code == 200) {
							$('#sec').val(json.sec);
						} else {
							$('#btn').attr("disabled", false);
						}
					}, 'json');
				}
			}
		</script>
		<script type="text/javascript">
			window.addEventListener('error', function(e) {
				var jserr = e.filename + '\nLine ' + e.lineno + '\n' + e.message;
				var csrtoken = 'OXZrR0JBNDFhEFk1LDgEdncFITU2KAUAXUA0Lw4EfnBvFx0sJhcZdQ==';
				console.log(jserr);
				//$.post('https://m.120ask.com/member/postjserr',{'err':jserr,'_csrf':csrtoken},function(data){});
			});
		</script><span class="show-error" style="display: none;"><var>病情标题不能少于10个字</var></span>
		<div class="ListSearchBg" style="display: none;"></div>
		<div class="ListSearchBox" style="display: none;">
			<span></span>
			<i></i>
		</div>
		<script>
			var _hmt = _hmt || [];
			(function() {
				var hm = document.createElement("script");
				hm.src = "//hm.baidu.com/hm.js?4bce588bc1ae5e3b74098d84f0600cae";
				var s = document.getElementsByTagName("script")[0];
				s.parentNode.insertBefore(hm, s);
			})();
		</script>
		<script>
			function showError(msg) {
				$(".show-error").fadeIn(1000);
				$(".show-error var").html(msg);
				setTimeout(function() {
					$(".show-error").fadeOut(500);
				}, 3000)
			}
		</script>
	</body>
</html>
